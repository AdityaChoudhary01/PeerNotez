# =======================================================
# 0. Build settings
# =======================================================
[build]
  command = "npm run build"
  publish = "dist"

# =======================================================
# 1. Headers (Performance Optimized)
# =======================================================

# Always fetch fresh HTML (prevents stale JS issues)
[[headers]]
for = "/index.html"
[headers.values]
  Cache-Control = "no-cache, no-store, must-revalidate"

# Service worker must NEVER be cached
[[headers]]
for = "/service-worker.js"
[headers.values]
  Cache-Control = "no-cache, no-store, must-revalidate"
  Pragma = "no-cache"
  Expires = "0"

# Vite hashed assets (JS, CSS, chunks) â€” safe to cache 1 year
[[headers]]
for = "/assets/*"
[headers.values]
  Cache-Control = "public, max-age=31536000, immutable"

# Manifest
[[headers]]
for = "/manifest.json"
[headers.values]
  Cache-Control = "no-cache"
  Content-Type = "application/json"

# Dynamic Sitemap (proxied to backend)
[[headers]]
for = "/sitemap.xml"
[headers.values]
  Content-Type = "application/xml"
  X-Robots-Tag = "all"
  Cache-Control = "no-cache"

# =======================================================
# 2. Redirects & Proxy
# =======================================================

# ðŸ”¥ API Proxy (REMOVES CORS + improves LCP)
[[redirects]]
from = "/api/*"
to = "https://peernotez.vercel.app/:splat"
status = 200
force = true

# Dynamic sitemap proxy
[[redirects]]
from = "/sitemap.xml"
to = "https://peernotez.vercel.app/sitemap.xml"
status = 200
force = true

# SPA fallback (must be LAST)
[[redirects]]
from = "/*"
to = "/index.html"
status = 200

# =======================================================
# 3. Prerendering
# =======================================================
[prerender]
  enabled = true
